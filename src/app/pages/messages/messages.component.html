<mat-drawer-container class="flex h-screen">
  <!-- Drawer: Chat List -->
  <mat-drawer #drawer mode="side" class="w-72 bg-primary-pale shadow-lg flex flex-col items-stretch p-2">
    <div class="mb-4 text-lg font-bold text-center text-primary">Chats</div>
    <ng-container>
      @for (friendName of friendChats; track friendName) {
        <mat-card
          class="mb-2 cursor-pointer transition-colors"
          [ngClass]="{
            'bg-primary text-white': chattingChatId === friendName[1],
            'bg-primary-lighter text-primary': chattingChatId !== friendName[1]
          }"
          (click)="openChatWindow(friendName[1],friendName[0],friendName[2]);"
        >
          <mat-card-header>
            <span>{{ friendName[0] }}</span>
          </mat-card-header>
        </mat-card>
      }
      <button mat-raised-button color="primary" class="w-full mt-4 bg-primary-light text-white hover:bg-primary" (click)="createNewChat();">
        Create new chat
      </button>
    </ng-container>
  </mat-drawer>

  <!-- Main Chat Area -->
  <mat-drawer-content class="flex-1 flex flex-col bg-primary-pale">
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 bg-primary-lighter">
      <div class="text-xl font-semibold text-primary text-center w-full pb-4">
        @if (currentChatName) {
          Chatting with: {{ currentChatName }}
        }
      </div>
      <mat-icon class="cursor-pointer text-primary" (click)="drawer.toggle()">
        {{ drawer.opened ? 'arrow_back_ios' : 'menu' }}
      </mat-icon>
    </div>

    <!-- Messages List -->
    <div class="flex-1 overflow-y-auto px-4 py-2 space-y-4">
      @for (message of chatMessages; track message) {
        <div class="flex" [ngClass]="{'justify-end': message.owner === loggedInUser!.displayName}">
          <div class="max-w-xs px-4 py-2 rounded-lg shadow"
               [ngClass]="{
                 'bg-primary text-white': message.owner === loggedInUser!.displayName,
                 'bg-primary-light text-primary': message.owner !== loggedInUser!.displayName
               }">
            <div class="text-xs font-semibold mb-1">{{ message.owner }}</div>
            <div class="break-words">{{ message.text }}</div>
            @if (loggedInOwnerInGroup || loggedInModInGroup) {
              <mat-icon class="bg-red-600 text-white cursor-pointer ml-2 align-middle rounded px-1" (click)="deleteMessageFromChat(message.id)">delete_forever</mat-icon>
            }
          </div>
        </div>
      }
    </div>

    <!-- Message Input (Sticky) -->
    <div class="border-t bg-primary-lighter px-4 py-3 flex items-end gap-2 sticky bottom-0">
      <mat-form-field class="flex-1">
        <textarea matInput cdkTextareaAutosize style="max-height: 30vh" [formControl]="messageToSend" placeholder="Type your message..."></textarea>
      </mat-form-field>
      <button mat-raised-button color="primary" class="bg-primary text-white hover:bg-primary-light" (click)="onSend(chattingChatId)">Send</button>
      @if (loggedInOwnerInGroup) {
        <button class="ml-2 bg-red-600 text-white rounded px-4 py-2 hover:bg-red-700 transition" mat-button (click)="deleteChat(chattingChatId)">DELETE CHAT</button>
      }
    </div>
  </mat-drawer-content>
</mat-drawer-container>

